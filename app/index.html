<!doctype html>
<html lang="en" ng-app="demoApp">
<head>
  <meta charset="utf-8">
  <title>Telemotiv Demonstration</title>

  <!-- Stylesheets -->
  <link rel="stylesheet" href="css/app.css"/>
  <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
  <link rel="stylesheet" type="text/css" href="css/speedometer.css" media="screen" />
  
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

  <!-- Script includes -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="//maps.googleapis.com/maps/api/js?key=AIzaSyDfp_hp8bSjJv8zCJ5ifsDOv9ClhjdZVk8&sensor=false"></script>
  <script src="lib/bootstrap.min.js"></script>

  <!--<script src="js/map.js"></script>-->
  <script type="text/javascript">
    function getPoints(file, result) {
      $.get(file, function(data) {
        var points = data.split(';');
        result(points)
      });  
    }
    function plotPoints(file) {
      getPoints(file, function(points){
        var marker
        var count = 0
        for (key in points) {
          arr = $.trim(points[key]).split(','); 
          latlng = new google.maps.LatLng(arr[0], arr[1])
          speed = arr[2];
          //Set speed
          speedometer.update(speed);

          if (count == 0) {
            marker = new google.maps.Marker({
                position: latlng,
                map: map,
                title:"2001 BMW X5",
                icon: "img/green_car.png"
            });
            // Click event
            google.maps.event.addListener(marker, 'click', function() {
              //Pop modal window.
              $('#myModal').modal({
                keyboard: true,
                show: true
              })
            });
          } else {
            setTimeout(function(marker, latlng) {
              marker.setPosition(latlng)
            }, 3000 * count, marker, latlng)
          }
          count++;
        }
      });
    }
  
    var map
    var speedometer;
    function initialize() {
      var mapOptions = {
        center: new google.maps.LatLng(45.52, -122.6819),
        zoom: 14
      };
      map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

      speedometer = new Speedometer ('speedometer', {theme: 'default'});
      speedometer.draw ();
    }
    google.maps.event.addDomListener(window, 'load', initialize);
  </script>

  <!-- Speedometer -->
  <script type="text/javascript" src="lib/speedometer/xcanvas.js"></script>
  <script type="text/javascript" src="lib/speedometer/tbe.js"></script>

  <script type="text/javascript" src="lib/speedometer/digitaldisplay.js"></script>
  <script type="text/javascript" src="lib/speedometer/speedometer.js"></script>
  <script type="text/javascript" src="lib/speedometer/themes/default.js"></script>

  

</head>
<body ng-controller="MapData">
  
  <!-- Modal -->
  <div id="myModal" class="modal hide" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
      <h3 id="myModalLabel">2001 BMW X5</h3>
    </div>
    <div class="modal-body">
      <div id="speedometer"></div>
      <div id="controls">
        Animate update:  <input type="button" id="update" value="start" /><br/>
        Animate rescale: <input type="text" id="maxvalue" value="200" />
                         <input type="button" id="rescale" value="rescale" /><br />
        Operating mode:
        <input type="radio" name="mode" id="incremental" checked="checked" /> incremental
        <input type="radio" name="mode" id="random" /> random
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
  </div>

  <div id="map-canvas"/>

  <script type="text/javascript">
    setTimeout(plotPoints, 1000, 'data/2001bmwx5');
  </script>


  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.13/angular.min.js"></script>
  <!--<script src="lib/angular/angular.js"></script>-->
  <script src="lib/angular/angular-route.js"></script>
  <script src="js/app.js"></script>
  <script src="js/services.js"></script>
  <script src="js/controllers.js"></script>
  <script src="js/filters.js"></script>
  <script src="js/directives.js"></script>
  
</body>
</html>
